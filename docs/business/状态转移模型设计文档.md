# 错题本系统 · 状态转移模型设计文档（V1）

每道题在任意时刻，处于以下之一：

``` text
NEW        新题（从未复习）
DUE        待复习（到期）
LEARNING   学习中（不稳定）
STABLE     稳定掌握
SUSPENDED  暂停（用户手动）
```

> ❗ 没有 “FAILED / MASTERED / ARCHIVED”
> 因为它们都会逼你过度设计

---

## 每个状态的业务含义

### NEW（新题）

* 刚录入
* 没有任何复习记录
* 必须至少复习一次

---

### DUE（待复习）

* 已到建议复习时间
* 会进入推荐复习列表

---

### LEARNING（学习中）

* 最近出现过错误或模糊
* 理解不稳定
* 复习频率较高

---

### STABLE（稳定掌握）

* 已连续多次答对
* 复习间隔较长
* 但**不会永久消失**

---

### SUSPENDED（暂停）

* 用户手动干预
* 系统不再推荐
* 可随时恢复

---

## 状态转移总览（核心图）

先给你一个**纯业务状态图（ASCII 版）**：

``` text
            ┌──────────┐
            │  NEW     │
            └────┬─────┘
                 │  首次复习
                 ▼
            ┌──────────┐
            │ LEARNING │◄───────────────┐
            └────┬─────┘                │
        连续正确 │                     │ 错 / 模糊
                 ▼                     │
            ┌──────────┐               │
            │  STABLE  │───────────────┘
            └────┬─────┘
        到期未复习 │
                 ▼
            ┌──────────┐
            │   DUE    │
            └────┬─────┘
                 │  复习
                 └────────► LEARNING / STABLE
```

`SUSPENDED` 是**旁路状态**：

``` text
任何状态 ──► SUSPENDED
SUSPENDED ──► NEW / LEARNING / DUE（恢复）
```

---

## 详细状态转移规则（逐条可执行）

### NEW → LEARNING

**触发条件**：用户完成首次复习（任意结果）

**原因**：新题一定是不稳定的

---

### LEARNING → LEARNING

**触发条件**：复习结果 = 错误 / 模糊

**副作用**：

* 连续正确次数清零
* 缩短下次复习间隔

---

### LEARNING → STABLE

**触发条件**：

* 连续正确 ≥ 3 次
* 且最近复习无错误

**注意**：这是**业务阈值**，不是算法真理

---

### STABLE → LEARNING

**触发条件**：任意一次复习结果 = 错误 / 模糊

**业务含义**：“曾经掌握 ≠ 永久掌握”

---

### STABLE → DUE

**触发条件**：当前时间 ≥ due_at

**说明**：

* STABLE 只是低频复习
* 到期仍需回顾

---

### DUE → LEARNING / STABLE

**触发条件**：用户完成复习

**分支**：

* 结果 = 错 / 模糊 → LEARNING
* 结果 = 正确 → STABLE（或保持）

---

### 任意状态 → SUSPENDED

**触发条件**：用户手动暂停

**规则**：系统不再推荐，不更新 due_at

---

### SUSPENDED → 原状态或 NEW

**触发条件**：用户手动恢复

**恢复策略**：统一回到 DUE （未来可能拓展）

---

## 状态 & 关键字段关系表

| 字段 | 用途 |
| - | - |
| state | 当前复习状态 |
| last_review_at | 判断到期 |
| last_result | 最近一次表现 |
| correct_streak | 判断稳定 |
| wrong_count | 长期统计 |
| due_at | 是否进入 DUE |

> 所有字段都是**派生或可重算的**
> 真正不可变的只有 Review 记录

---

## 设计上的“刻意留白”

**不定义“毕业状态”**：否则用户永远不会再复习

**不自动进入 SUSPENDED**：控制权必须在用户

**不根据统计反向改变状态**：统计是解释，不是驱动

---
