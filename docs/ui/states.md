# 错题本系统 · 状态转移模型设计文档（V1）

### 1️⃣ 状态属于「题目」，不是复习记录

* Review 是事件（不可变）
* State 是题目的派生状态（可变）

### 2️⃣ 状态数量必须少

> 状态越少，系统越稳

我们**只用 5 个状态**。

---

# 二、题目复习状态定义（定稿）

每道题在任意时刻，处于以下之一：

```
NEW        新题（从未复习）
DUE        待复习（到期）
LEARNING   学习中（不稳定）
STABLE     稳定掌握
SUSPENDED  暂停（用户手动）
```

> ❗ 没有 “FAILED / MASTERED / ARCHIVED”
> 因为它们都会逼你过度设计

---

# 三、每个状态的业务含义

### 1️⃣ NEW（新题）

* 刚录入
* 没有任何复习记录
* 必须至少复习一次

---

### 2️⃣ DUE（待复习）

* 已到建议复习时间
* 会进入推荐复习列表

---

### 3️⃣ LEARNING（学习中）

* 最近出现过错误或模糊
* 理解不稳定
* 复习频率较高

---

### 4️⃣ STABLE（稳定掌握）

* 已连续多次答对
* 复习间隔较长
* 但**不会永久消失**

---

### 5️⃣ SUSPENDED（暂停）

* 用户手动干预
* 系统不再推荐
* 可随时恢复

---

# 四、状态转移总览（核心图）

先给你一个**纯业务状态图（ASCII 版）**：

```
            ┌──────────┐
            │  NEW     │
            └────┬─────┘
                 │  首次复习
                 ▼
            ┌──────────┐
            │ LEARNING │◄───────────────┐
            └────┬─────┘                │
        连续正确 │                     │ 错 / 模糊
                 ▼                     │
            ┌──────────┐               │
            │  STABLE  │───────────────┘
            └────┬─────┘
        到期未复习 │
                 ▼
            ┌──────────┐
            │   DUE    │
            └────┬─────┘
                 │  复习
                 └────────► LEARNING / STABLE
```

`SUSPENDED` 是**旁路状态**：

```
任何状态 ──► SUSPENDED
SUSPENDED ──► NEW / LEARNING / DUE（恢复）
```

---

# 五、详细状态转移规则（逐条可执行）

下面这部分，你可以**直接翻译成 if / match 逻辑**。

---

## 1️⃣ NEW → LEARNING

**触发条件**

* 用户完成首次复习（任意结果）

**原因**

* 新题一定是不稳定的

---

## 2️⃣ LEARNING → LEARNING

**触发条件**

* 复习结果 = 错误 / 模糊

**副作用**

* 连续正确次数清零
* 缩短下次复习间隔

---

## 3️⃣ LEARNING → STABLE

**触发条件（示例）**

* 连续正确 ≥ 3 次
* 且最近复习无错误

**注意**

* 这是**业务阈值**，不是算法真理

---

## 4️⃣ STABLE → LEARNING

**触发条件**

* 任意一次复习结果 = 错误 / 模糊

**业务含义**

* “曾经掌握 ≠ 永久掌握”

---

## 5️⃣ STABLE → DUE

**触发条件**

* 当前时间 ≥ due_at

**说明**

* STABLE 只是低频复习
* 到期仍需回顾

---

## 6️⃣ DUE → LEARNING / STABLE

**触发条件**

* 用户完成复习

**分支**

* 结果 = 错 / 模糊 → LEARNING
* 结果 = 正确 → STABLE（或保持）

---

## 7️⃣ 任意状态 → SUSPENDED

**触发条件**

* 用户手动暂停

**规则**

* 系统不再推荐
* 不更新 due_at

---

## 8️⃣ SUSPENDED → 原状态或 NEW

**触发条件**

* 用户手动恢复

**恢复策略**

* 可回到暂停前状态
* 或统一回到 NEW（简化实现）

---

# 六、状态 & 关键字段关系表（非常实用）

| 字段             | 用途       |
| -------------- | -------- |
| state          | 当前复习状态   |
| last_review_at | 判断到期     |
| last_result    | 最近一次表现   |
| correct_streak | 判断稳定     |
| wrong_count    | 长期统计     |
| due_at         | 是否进入 DUE |

> ❗ 所有字段都是**派生或可重算的**
> 真正不可变的只有 Review 记录

---

# 七、设计上的“刻意留白”

### ❌ 不定义“毕业状态”

→ 否则你永远不会再复习

### ❌ 不自动进入 SUSPENDED

→ 控制权必须在用户

### ❌ 不根据统计反向改变状态

→ 统计是解释，不是驱动

---

# 八、最小可行实现（MVP 状态子集）

如果你要 **第一版极简**，可以先只用：

```
NEW → LEARNING → STABLE → DUE
```

`SUSPENDED` 可以第二阶段再加。

---

# 九、你现在已经具备的能力

到这一步，你已经可以：

* 画 ER 图
* 写状态机
* 设计 SQL 更新逻辑
* 写单元测试（按状态转移）

**这不是“想法”，这是系统骨架。**

---

## 下一步建议（强烈）

现在最自然的下一步是三选一：

1️⃣ 把这个状态机 **映射到数据库字段设计**
2️⃣ 把状态转移 **映射到 UI 行为（按钮 / 提示）**
3️⃣ 把复习推荐逻辑 **直接写成伪代码**

你选哪个，我继续往“能直接写代码”的方向推。
